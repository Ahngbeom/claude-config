---
name: prefer-database-expert
enabled: true
event: file
conditions:
  - field: file_path
    operator: regex_match
    pattern: (migration|schema|seed|model)\.(ts|js|sql)$
action: warn
---

🗄️ **데이터베이스 스키마 작업이 감지되었습니다!**

**`database-expert` 에이전트** 사용을 권장합니다.

## 에이전트를 사용하면

✅ **안전한 마이그레이션 전략** - 무중단 배포 고려
✅ **인덱스 최적화** - 쿼리 성능 향상
✅ **데이터 무결성 보장** - FK, 제약조건, 트랜잭션
✅ **롤백 계획 자동 생성** - down 마이그레이션
✅ **타입 안전성** - Prisma, TypeORM, Sequelize 모범 사례

## 사용 방법

대신 다음과 같이 요청해주세요:
```
"database-expert 에이전트로 유저 테이블 스키마 만들어줘"
"이메일 인증 필드 추가하는 마이그레이션 생성해줘"
"인덱스 최적화 전략 제안해줘"
```

Claude가 자동으로 `database-expert` 에이전트를 사용하여 안전하게 처리합니다.

## 주요 개선 사항

### 마이그레이션 안전성
- **무중단 배포**: 기존 데이터 보존
- **롤백 가능**: 문제 발생 시 되돌리기
- **단계별 변경**: 큰 변경을 여러 단계로 분할

### 성능 최적화
- **인덱스 전략**: B-Tree, Hash, GiST 등 최적 선택
- **쿼리 최적화**: N+1 문제 해결, EXPLAIN 분석
- **파티셔닝**: 대용량 데이터 처리

### 데이터 무결성
- **외래 키**: 관계 정의 및 ON DELETE 전략
- **유니크 제약**: 중복 방지
- **체크 제약**: 도메인 규칙 강제

---

**⚠️ 주의**: 데이터베이스 변경은 되돌리기 어려울 수 있습니다. 에이전트를 사용하면 더 안전합니다.

**계속 진행하시겠습니까?**
